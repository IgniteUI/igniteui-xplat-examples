trigger:
  branches:
    include:
    - vnext
    - master
    - '2022.2'

pr:
  branches:
    exclude:
    - '*'  # must quote since "*" is a YAML reserved character; we want a string

name: $(BuildDefinitionName)_$(Year:yyyy).$(Month).$(DayOfMonth)$(Rev:.r)

stages:
- stage: Build
  pool:
    name: BuildAgentOnPrem
  jobs:
  - job: BuildApp
    steps:
    - checkout: self
    - task: UseDotNet@2
      displayName: 'Use .NET 6'
      inputs:
        packageType: 'sdk'
        version: '6.x'

    - task: DotnetGlobalToolInstaller@0
      inputs:
        name: 'Powershell'
        versionSpec: '6.*'
        checkLatest: true

    - task: PowerShell@2
      displayName: 'Fetch latest WPF.DEV NuGet packages and register a local dir NuGet repo for them'
      inputs:
        targetType: 'inline'
        script: |
          foreach ($jsonFile in Get-ChildItem "$(Build.SourcesDirectory)\igniteui-xplat-examples\samples" -Filter "*.json" -Recurse)
              {
                Write-Output "Parsing $($jsonFile.FullName)"
                $exportFlag = $(jq .export $jsonFile.FullName -e)
                if ($exportFlag -eq $null -Or $exportFlag -eq "false") {
                    
                    Remove-Item $jsonFile.FullName
                    Write-Output "Removed $($jsonFile.FullName) - export flag is false or missing"
                }
              }
        pwsh: true

